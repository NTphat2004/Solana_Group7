<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create NFT</title>
    <style>
        .gradient-background {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            height: 100vh;
        }
        .form-container {
            background-color: #FFFFFFEE;
            padding: 20px;
            border-radius: 10px;
        }
        .uploaded-img img {
            height: 100%;
            width: 100%;
            object-fit: cover;
        }
        .button-24, .button-25 {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const xApiKey = "0ZZi5a0Eo89-knJM"; // Enter Your x-api-key here
        let file, displayPic = './resources/images/upload-file.jpg', network = 'devnet';
        let publicKey = '7CqNMsdsHzxvCtAqYN3KNAk496x6XAzgaUSbhSaRupZB', name, symbol, desc;
        let attr = JSON.stringify([{"trait_type": "edification","value": "100"}]), extUrl, maxSup = 0, roy = 99;
        let minted, saveMinted, errorRoy, status = 'Awaiting Upload', dispResponse = '', connStatus = true;

        function handleFileChange(event) {
            const [file_selected] = event.target.files;
            file = event.target.files[0];
            displayPic = URL.createObjectURL(file_selected);
            document.getElementById('uploaded-img').src = displayPic;
        }

        async function signAndConfirmTransactionFe(network, transaction, callback) {
            // Implement your sign and confirm transaction function here
        }

        function mintNow(event) {
            event.preventDefault();
            status = "Loading";
            updateStatus();

            let formData = new FormData();
            formData.append("network", network);
            formData.append("wallet", publicKey);
            formData.append("name", name);
            formData.append("symbol", symbol);
            formData.append("description", desc);
            formData.append("attributes", JSON.stringify(attr));
            formData.append("external_url", extUrl);
            formData.append("max_supply", maxSup);
            formData.append("royalty", roy);
            formData.append("file", file);

            axios({
                url: "https://api.shyft.to/sol/v1/nft/create_detach",
                method: "POST",
                headers: {
                    "Content-Type": "multipart/form-data",
                    "x-api-key": xApiKey,
                    Accept: "*/*",
                    "Access-Control-Allow-Origin": "*",
                },
                data: formData,
            })
            .then(async (res) => {
                if (res.data.success === true) {
                    status = "success: Transaction Created. Signing Transactions. Please Wait.";
                    const transaction = res.data.result.encoded_transaction;
                    saveMinted = res.data.result.mint;
                    const ret_result = await signAndConfirmTransactionFe(network, transaction, callback);
                    dispResponse = res.data;
                    updateResponse();
                }
            })
            .catch((err) => {
                console.warn(err);
                status = "success: false";
                updateStatus();
            });
        }

        function updateStatus() {
            document.getElementById('status').innerText = status;
        }

        function updateResponse() {
            document.getElementById('response').value = JSON.stringify(dispResponse);
        }

        function callback(signature, result) {
            if (signature.err === null) {
                minted = saveMinted;
                status = "success: Successfully Signed and Minted.";
                updateStatus();
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById('create-nft-form').addEventListener('submit', mintNow);
        });
    </script>
</head>
<body>
    <div class="gradient-background">
        <div class="container p-5">
            <div class="form-container border border-primary rounded py-3 px-5">
                <h3 class="pt-4">Create An Nft</h3>
                <p>This Sample Project Illustrates how to create new NFTs using SHYFT APIs.</p>
                <form id="create-nft-form">
                    <div class="img-container text-center mt-5">
                        <div class="uploaded-img" style="height: 200px; width: 200px; background-color: grey; margin: 0 auto; border-radius: 10px;">
                            <img id="uploaded-img" src="./resources/images/upload-file.jpg" alt="To be uploaded">
                        </div>
                        <div class="mt-3"></div>
                        <button class="btn btn-primary button-24 text-light rounded-pill m-2">Select File</button><br>
                        <input type="file" style="position: absolute; z-index: 3; margin-top: -50px; margin-left: -70px; width: 150px; height: 40px; opacity: 0;" onchange="handleFileChange(event)">
                        <div class="mb-3"></div>
                    </div>
                    <div class="fields">
                        <table class="table">
                            <tbody>
                                <tr>
                                    <td class="py-4 ps-2 w-50 text-start">
                                        Network<br>
                                        <small>Solana blockchain environment (testnet/devnet/mainnet-beta)</small>
                                    </td>
                                    <td class="px-5 pt-4">
                                        <select name="network" class="form-select" onchange="network = this.value">
                                            <option value="devnet">Devnet</option>
                                            <option value="testnet">Testnet</option>
                                            <option value="mainnet-beta">Mainnet Beta</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-4 ps-2 w-50 text-start">
                                        Public Key<br>
                                        <small>Your wallet's public key (string)</small>
                                    </td>
                                    <td class="px-5 pt-4">
                                        <input type="text" class="form-control" placeholder="Enter Your Wallet's Public Key" value="7CqNMsdsHzxvCtAqYN3KNAk496x6XAzgaUSbhSaRupZB" oninput="publicKey = this.value" required>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-4 ps-2 text-start">Name<br>
                                        <small>Your NFT Name (string)</small>
                                    </td>
                                    <td class="px-5 pt-4">
                                        <input type="text" class="form-control" placeholder="Enter NFT Name" oninput="name = this.value" required>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-4 ps-2 text-start">Symbol<br>
                                        <small>Your NFT Symbol (string)</small>
                                    </td>
                                    <td class="px-5 pt-4">
                                        <input type="text" class="form-control" placeholder="symbol" oninput="symbol = this.value" required>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-4 ps-2 text-start">Description <br>
                                        <small>Add a small story to this NFT (string)</small>
                                    </td>
                                    <td class="px-5 py-3">
                                        <textarea class="form-control" placeholder="Enter Description" oninput="desc = this.value" required></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-4 ps-2 text-start">Attributes <br>
                                        <small>Attributes associated to this NFT. (Should have 'trait_type' and 'value')</small>
                                    </td>
                                    <td class="px-5 py-3">
                                        <textarea class="form-control" placeholder="Enter Attributes" oninput="attr = this.value" required></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-4 ps-2 text-start">External Url <br>
                                        <small>Any url to associate with the NFT</small>
                                    </td>
                                    <td class="px-5 pt-4">
                                        <input type="text" class="form-control" placeholder="Enter Url if Any" oninput="extUrl = this.value">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="p-5 text-center">
                            <button type="submit" class="btn btn-success button-25">Submit</button>
                        </div>
                    </div>
                </form>
                <div class="text-center">
                    This creates one of kind NFTs by setting the <code>max_supply</code> parameter to 0. But you can update it if needed, it should be between <i>0-100</i>.
                </div>
            </div>
            <div class="py-5">
                <h2 class="text-center pb-3">Response</h2>
                <div id="status" class="status text-center text-info p-3"><b>Awaiting Upload</b></div>
                <textarea id="response" class="form-control" name="" cols="30" rows="10"></textarea>
            </div>
            <div class="p-3 text-center">
                <a id="view-on-explorer" href="#" target="_blank" class="btn btn-warning m-2 py-2 px-4" style="display: none;">View on Explorer</a>
            </div>
        </div>
    </div>
</body>
</html>
